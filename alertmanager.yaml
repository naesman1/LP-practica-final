global:
  resolve_timeout: 5m
  # URL del Webhook de Slack (reemplaza con la tuya)
  slack_api_url: 'https://hooks.slack.com/services/XXXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXXXXXXX'

route:
  group_by: ['alertname', 'job', 'severity']
  group_wait: 10s
  group_interval: 1m
  repeat_interval: 10m
  receiver: 'slack'
  routes:
    # Ignorar alertas de Watchdog (prueba interna)
    - match:
        alertname: Watchdog
      receiver: 'null'

    # Canal para alertas crÃ­ticas
    - match:
        severity: 'critical'
      receiver: 'slack-critical'

receivers:
  # Receptor nulo (para Watchdog u otras alertas de prueba)
  - name: 'null'

  # ðŸ”´ Canal para alertas crÃ­ticas
  - name: 'slack-critical'
    slack_configs:
      - slack_api_url: 'https://hooks.slack.com/services/XXXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXXXXXXX'
        channel: '#naesman-prometheus-alarms'
        send_resolved: true
        title: >
          {{ if eq .Status "firing" }}
          ðŸš¨ [{{ .Status | toUpper }}] {{ .CommonLabels.alertname }} ({{ .CommonLabels.severity | toUpper }})
          {{ else }}
          âœ… [{{ .Status | toUpper }}] {{ .CommonLabels.alertname }} ({{ .CommonLabels.severity | toUpper }})
          {{ end }}
        text: >-
          {{ range .Alerts -}}
          *Estado:* `{{ .Status }}`
          *Alerta:* `{{ .Labels.alertname }}`
          *Severidad:* `{{ .Labels.severity }}`
          *DescripciÃ³n:* {{ .Annotations.description }}
          {{ if .Labels.pod }}*Pod:* `{{ .Labels.pod }}`{{ end }}
          {{ if .Labels.container }}*Contenedor:* `{{ .Labels.container }}`{{ end }}
          {{ if .Labels.namespace }}*Namespace:* `{{ .Labels.namespace }}`{{ end }}
          {{ if .Labels.instance }}*Instancia:* `{{ .Labels.instance }}`{{ end }}
          {{ if eq .Status "resolved" }}ðŸŸ¢ *La alerta ha sido resuelta.*{{ end }}
          {{ end }}

  # ðŸ”µ Canal para alertas informativas o de nivel normal
  - name: 'slack'
    slack_configs:
      - slack_api_url: 'https://hooks.slack.com/services/XXXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXXXXXXX'
        channel: '#naesman-prometheus-alarms'
        send_resolved: true
        title: >
          {{ if eq .Status "firing" }}
          â„¹ï¸ [{{ .Status | toUpper }}] {{ .CommonLabels.alertname }}
          {{ else }}
          âœ… [{{ .Status | toUpper }}] {{ .CommonLabels.alertname }}
          {{ end }}
        text: >-
          {{ range .Alerts -}}
          *Estado:* `{{ .Status }}`
          *DescripciÃ³n:* {{ .Annotations.description }}
          {{ if .Labels.pod }}*Pod:* `{{ .Labels.pod }}`{{ end }}
          {{ if eq .Status "resolved" }}ðŸŸ¢ *La alerta ha sido resuelta.*{{ end }}
          {{ end }}
